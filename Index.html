<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
   <script>
   // Get the list of statuses from the spreadsheet when app launched and store to dataStorage div's data attribute for reference
      window.onload = function() {
        google.script.run.withSuccessHandler(sheetDataToAttrib).getDataFromSheet("statuses", 'A1:A3')
      };
   
     function sheetDataToAttrib(input) {
       var dataStorage = document.getElementById("storedData");
       dataStorage.setAttribute("data-status-list", input);
       console.log(getStoredData("status-list"));
     }
       
     function getStoredData(dataName){
          var rawData = document.getElementById("storedData").getAttribute("data-" + dataName);
          var data = rawData.split(",");
          return data;
     }
   
   
   
    function showTableItem(row, col){
        var text = document.getElementById("itemTable").rows[row].cells[col].innerHTML;
        document.getElementById("test").innerHTML = text;
    }
    function getTableItem(row, col){
        var text = document.getElementById("itemTable").rows[row].cells[col].innerHTML;
        return text;
    }
    function setTableItem(input, row, col){                         // this has become a lot less usefully generic when I hardcoded it to work only with the status list
                                                                     //(that line with getStoredData("status-list") was originally in cycleStatus() )
        var newStatus = getStoredData("status-list")[input];
        document.getElementById("itemTable").rows[row].cells[col].getElementsByTagName('BUTTON')[0].innerHTML = newStatus;
        document.getElementById("itemTable").rows[row].cells[col].getElementsByTagName('BUTTON')[0].value = input;
        console.log("Input " + newStatus + " (" + input + ") into the table at row " + row + ", column " + col);
    }
    
    
    function cycleStatus(oldStatusNum, row, col){
       console.log("status passed to cycle: " + oldStatusNum);
       var newStatus = (oldStatusNum + 1)%3;
       
       setTableItem(newStatus, row, col);
       
       document.getElementById("test").innerHTML = newStatus;
    }
    
    
    
    function createTable(tableData) {
        var table = document.createElement('table');
        table.setAttribute("id", "itemTable");
        var tableBody = document.createElement('tbody');
        
        var rowCnt = 0;
        tableData.forEach(function(rowData) {
            var row = document.createElement('tr');
            
            var colCnt = 0;
            rowData.forEach(function(cellData) {
                var cell = document.createElement('td');
                
                if(colCnt == 1) {
                
                    var statusList = getStoredData("status-list");
                    
                    var btn = document.createElement("BUTTON");
                    //btn.setAttribute("onClick", "javascript:cycleStatus(" + cellData + ", " + rowCnt + ", " + colCnt + ")");
                    btn.setAttribute("onClick", "javascript:cycleStatus(this.value, " + rowCnt + ", " + colCnt + ")");               ////////////// pretty sure I can do these status settings in a more compact way
                    btn.setAttribute("class", "statusButton");
                    btn.setAttribute("value", cellData);
                    
                    btn.innerHTML = statusList[cellData];

                    
                   // var t = document.createTextNode(statusList[cellData] + " " + rowCnt);
                    //var t = document.createTextNode(statusList[cellData]);
                    //btn.appendChild(t);
                    cell.appendChild(btn);
                } else {
                    
                    var t = document.createTextNode(cellData);
                    cell.appendChild(t);
                }
                

                row.appendChild(cell);
                colCnt++;
            });
            tableBody.appendChild(row);
            rowCnt++;
        });
        table.appendChild(tableBody);
        document.getElementById("tableContainer").innerHTML = "";
        document.getElementById("tableContainer").appendChild(table);
        
        console.log("successfully created table");
    }



  </script>
  
  
  
  
  
  
  </head>
  
  <body>
    <div id="storedData"></div>
    <div id="container" class="container">
     <input type="button" value="Create Table" 
          onClick="google.script.run.withSuccessHandler(createTable).getDataTest('A1:B4')"/> &ensp;
      <br>
      <input type="button" value="Item ref test"
          onClick="javascript:showTableItem(2,0);"/> &ensp;
      <br>
      ..........
      <br>
      <div id="tableContainer" align="center">Table will go here</div>
      <br>
      
      <div id = "test"> nothing to see here... </div>
    </div>
  </body>
  
  







  
  <style>
      /* item status button style */
   .statusButton {
      width: 7.5em;
      height: 3em;
      border: 4.6px double grey;
      border-radius: 15px;
      padding: 7px;
    }
    
     /* table style */
   tr {height: 1em; padding: 4px; font-size: 200%;}
   td {width: 4em; padding: 4px;}
  
  
    /* border around app/more defined app size */
   .container {
      width: 95%;
/*      height: 100%; /* not sure why this doesn't have an affect */
      height: 675px;
      border: 4px double grey;
      border-radius: 15px;
      padding: 10px;
    }
  </style>
</html>